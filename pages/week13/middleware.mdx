import { Callout, Steps } from "nextra-theme-docs";

# Middleware

Middleware is a powerful feature that allows you to run server-side code during the lifecycle of a request. Middleware functions can perform tasks like manipulating the request or response objects, handling cookies, checking authentication status, and more. Most modern web frameworks have some sort of middleware system.

This week we'll learn how to create and use middleware in Next.js, and then we'll learn how middleware can be used to implement authentication in our applications.

## Next.js Middleware

To implement middleware in Next.js, we need to create a file called `middleware.js` in the root of the project.

Here is an example of a middleware function that redirects the user to the login page if they are not authenticated:

```ts
import type { NextRequest } from "next/server";
import { NextResponse } from "next/server";
import { getSession } from "next-auth/client";

export function middleware(request: NextRequest) {
  const session = await getSession({ request });

  if (!session) {
    return NextResponse.redirect(new URL("/login", request.nextUrl));
  }
}
```

Please read through this short page on [middleware in Next.js](https://nextjs.org/docs/app/building-your-application/routing/middleware) or watch the video below.

<iframe
  style={{ width: "100%", aspectRatio: "16/9" }}
  src="https://www.youtube.com/embed/NUHAc1wjL3A?si=LtbI50mvskMIJkBo"
  title="YouTube video player"
  frameBorder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
  allowFullScreen="allowFullScreen"
></iframe>

## Auth.js

Auth.js (formerly NextAuth.js) is a library that makes it easy to add authentication to your Next.js application. It supports a wide variety of authentication providers, including email/password, OAuth, and more. It also supports a wide variety of databases, including MongoDB, Postgres, and Prisma ORM.

New documentation can be found here: https://authjs.dev/getting-started/introduction

Old documentation can be found here: https://next-auth.js.org/getting-started/introduction

### Next-Auth.js Tutorials

Here are some tutorials that will help you get started with Next-Auth.js:

<iframe
  style={{ width: "100%", aspectRatio: "16/9" }}
  src="https://www.youtube.com/embed/w2h54xz6Ndw?si=8hNonqZsd-NQ2-vD"
  title="YouTube video player"
  frameBorder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
  allowFullScreen="allowFullScreen"
></iframe>

<iframe
  style={{ width: "100%", aspectRatio: "16/9" }}
  src="https://www.youtube.com/embed/md65iBX5Gxg?si=dQRnlXYe3Oxt9rhH"
  title="YouTube video player"
  frameBorder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
  allowFullScreen="allowFullScreen"
></iframe>

## Starter Templates

As we move into more complex applications, you may find it helpful to use a starter template. For example, here are some starter templates that use Next-Auth.js and PlanetScale: https://vercel.com/templates?framework=next.js&auth=nextauth.js&database=planetscale
